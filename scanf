#include <stdio.h>
#include <stdarg.h>

static int pushed_char = -1;

int read_char(void) {
    if (pushed_char != -1) {
        int c = pushed_char;
        pushed_char = -1;   // reset global variable
        return c;
    }
    return getchar();
}

void unread_char(int c) {
    pushed_char = c;
}

//ignore whitespace

void skip_whitespaces(void) {
    int c;
    while ((c = read_char()) != EOF) {
        if (c==' ' || c=='\t' || c=='\n' || c=='\r' || c=='\v' || c=='\f') {
            unread_char(c);
            return;
        }
    }
}

// reading a decimal integer

int read_decimal(int *out) {
    int c;
    int sign = 1;
    int value = 0;
    int digits_read = 0;

    skip_whitespaces();

    c = read_char();
    if (c == '-') {
        sign = -1;
    } else if (c == '+') {
        sign = 1;
    } else {
        unread_char(c);
    }

    while ((c = read_char()) != EOF) {
        if (c >= '0' && c <= '9') {
            value = value * 10 + (c - '0');
            digits_read++;
        } else {
            unread_char(c);
            break;
        }
    }

    if (digits_read == 0) {
        return 0;   // failure
    }

    *out = sign * value;
    return 1;       // success
}
// %c
int read_char_specifier(char *out) {
    int c = read_char();
    if (c == EOF) return 0;  // fail
    *out = c;
    return 1;                // success
}

int my_scanf(const char *fmt, ...) {
    va_list args;
    int assigned = 0;

    va_start(args, fmt);

    if (*fmt == '%' && *(fmt + 1) == 'd') {
        int *ptr = va_arg(args, int *);
        if (read_decimal(ptr)) {
            assigned = 1;
        }
    }
    else if (*fmt == '%' && *(fmt + 1) == 'c') {
        char *ptr = va_arg(args, char *);
        if (read_char_specifier(ptr)) {
            assigned = 1;
        }
    }

    va_end(args);
    return assigned;
}

//test

int main(void) {
    int x;
    char ch;

    if (my_scanf("%d", &x) == 1) {
        printf("You entered: %d\n", x);
    }
    else if (my_scanf("%c", &ch) == 1) {
        printf("You entered: %c\n", ch);
    } else {
        printf("Invalid input\n");
    }

    return 0;
}


